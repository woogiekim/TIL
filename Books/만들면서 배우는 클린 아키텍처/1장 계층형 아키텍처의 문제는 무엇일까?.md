# 계층형 아키텍처의 문제는 무엇일까?

- 웹 계층에서는 요청을 받아 도메인 혹은 비즈니스 계층에 있는 서비스로 요청을 보낸다.
- 서비스에서는 필요한 비즈니스 로직을 수행하고, 도메인 엔티티의 현재 상태를 조회하거나 변경하기 위해 영속성 계층의 컴포넌트를 호출한다.


- 사실 계층형 아키텍터는 견고한 아키텍처 패턴이다. 계층을 잘 이해하고 구성한다면 웹 계층이나 영속성 계층에 독립적으로 도메인 로직을 작성할 수 있다.
- 원한다면 도메인 로직에 영향을 주지 않고 웹 계층과 영속성 계층에 사용된 기술을 변경할 수 있다. 기존 기능에 영향을 주지 않고 새로운 기능을 추가할 수도 있다.


## 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다

- 우리는 상태(state)가 아니라 행동(behavior)을 중심으로 모델링한다. 어떤 애플리케이션이든 상태가 중요한 요소이긴 하지만 행동이 상태를 바꾸는 주체이기 때문에 행동이 비즈니스를 이끌어간다.

- 그동안 만들어 본 애플리케이션의 유스케이스를 한번 떠올려보자. 도메인 로직을 먼저 구현했는가 아니면 영속성 계층을 먼저 구현했는가?
- 아마 데이터베이스의 구조를 먼저 생각하고, 이를 토대로 도메인 로직을 구현했을 것이다.


- 이는 전통적인 계층형 아키텍처에서는 합리적인 방법이다. 의존성의 방향에 따라 자연스럽게 구현한 것이기 떄문이다. 비즈니스 관점에서는 전혀 맞지 않은 방법이다.
- 다른 무엇보다도 도메인 로직을 먼저 만들어야 한다. 그래야만 우리가 로직을 제대로 이해했는지 확인할 수 있다. 그리고 도메인 로직이 맞다는 것을 확인한 후에 이를 기반으로 영속성 계층과 웹 계층을 만들어야 한다.


## 지름길으 택하기 쉬워진다

- 전통적인 계층형 아키텍처에서 전체적으로 적용되는 유일한 규칙은, 특정한 계층에서는 같은 계층에 있는 컴포넌트나 아래에 있는 계층에만 접근 가능하다는 것이다.
- 계층형 아키텍처 자체는 위 규칙 외에 다른 규칙을 강제하지 않는다.
- 따라서 만약 상위 계층에 위치한 컴포넌트에 접근해야 한다면 간단하게 컴포넌트를 계층 아래로 내려버리면 된다. 그러면 접근 가능하게 되고, 깔끔하게 문제가 해결된다.
- 딱 한번 이렇게 하는 것은 괜찮을 수 있다. 하지만 처음이 힘들지 그 다음부터는 죄책감이 훨씬 덜하다. 또 동료가 그렇게 한다면, 나 역시 그렇게 해도 된다는 마음이 들지 않을까?


## 테스트하기 어려워진다

- 계층형 아키텍처를 사용할 때 일반적으로 나타나는 변화의 형태는 계층을 건너뛰는 것이다. 엔티티의 필드를 단 하나만 조작하면 되는 경우에 웹 계층에서 바로 영속성 계층에 접근하면 도메인 계층을 건드릴 필요가 없지 않을까?
- 다시 한번 말하지만 처음 몇 번은 괜찮게 느껴진다. 하지만 이런 일이 자주 일어난다면 (그리고 누군가 한 발짝 먼저 내디딘다면 꼭 그렇게 된다) 두 가지 문제점이 생긴다.
- 첫 번째 문제는 단 하나의 필드를 조작하는 것에 불과하더라도 도메인 로직을 웹 계층에 구현하게 된다는 것이다.
- 만약 앞으로 유스케이스가 확장된다면 어떻게 될까? 아마도 더 많은 도메인 로직을 웹 계층에 추가해서 애플리케이션 전반에 걸쳐 책임이 섞이고 핵심 도메인 로직들이 퍼져나갈 확률이 높다.


## 유스케이스를 숨긴다

- 기능을 추가하거나 변경할 적절한 위치를 찾는 일이 빈번하기 때문에 아키텍처는 코드를 빠르게 탐색하는 데 도움이 돼야 한다.
- 이런 관점에서 계층형 아키텍처는 어떻게 우리의 발목을 잡을까?
- 계층형 아키텍처는 도메인 서비스의 '너비'에 관한 규칙을 강제하지 않는다. 그렇기 떄문에 시간이 지나면 그림 1.5처럼 여러 개의 유스케이스를 담당하는 아주 널은 서비스가 만들어지기도 한다.


## 동시작업이 어려워진다


## 유지보수 가능한 소프트웨어를 만드는 데 어떻게 도움이 될까?

- 계층형 아키텍처는 많은 것들이 잘못된 방향으로 흘러가도록 용인한다. 아주 엄격한 자기 훈련 없이는 시간이 지날수록 품질이 저하되고 유지보수하기가 어려워지기 쉽다
- 그리고 이러한 자기 훈련은 보통 프로젝트 매니저가 개밡림에 새로운 마감일을 설정할 때마다 조금씩 느슨해지기 마련이다.
- 계층형 아키텍처로 만들든 다른 아키텍처 스타일로 만들든, 계층형 아키텍처의 함정을 염두에 두면 지름길을 택하지 않고 유지보수하기에 더 쉬운 솔루션을 만드는 데 도움이 될 것이다.