# 드디어, 더하기

- 설계쌍 가장 어려운 제약은 다중 통화 사용에 대한 내용을 시스템의 나머지 코드에게 숨기고 싶다는 점이다.
- 하지만 이 방시긍로는 여러 환율을 쓰기가 쉽지 않다.
- 대신, 편하게 여러 환율을 표현할 수 있으면서도 산술 연산 비슷한 표현들을 여전히 산술 연산처럼 다룰 수 있는 해법이 있으면 좋을 것 같다.
- 객체가 우리를 구해줄 것이다.
- 가지고 있는 개체가 우리가 원하는 방식으로 동작하지 않을 경우엔 그 객체와 외부 프로토콜이 같으면서 내부 구현은 다른 새로운 객체(imposter, 타인을 사칭하는 사기꾼)를 만들 수 있다.
- 약간 신기해 할지도 모르겠다. 여기에 사칭 사기꾼을 만들 생각을 한다는 걸 어떻게 알 수 있을까?
- 번뜩이는 설계상의 착상을 가능케 해주는 공식 같은 건 없다.
- TDD는 적절한 떄에 번뜩이는 통찰을 보장하지 못한다.
- 그렇지만 확신을 주는 테스트와 조심스럽게 정리된 코드를 통해, 통찰에 대한 준비와 함께 통찰이 번뜩일 때 그걸 적용할 준비를 할 수 있다.
- 해법은 Money와 비슷하게 동작하지만 사실은 두 Money의 합을 나타내는 객체를 만드는것이다.
- 나는 이 아이디어를 설명하기 위한 몇 가지 다른 메타포를 생각해봤다.
- 한 가지는 Money의 합을 마치 `지갑`처럼 취깁하는 것이다. 한 지갑에는 금액과 통화가 다른 여러 화폐들이 들어갈 수 있다.
- 또 다른 메타포는 '(2 + 3) x 5' 와 같은 수식이다. 우리 경우엔 '($2 + 3CHF) x 5'가 되겠지만. 이러헥 하면 Money를 수식의 가장 작은 단위로 볼 수 있다.
- 연산의 결과로 Expression들이 생기는데, 그 중 하나는 Sum(합)이 될 것이다.
- 연산(포트폴리오의 값을 합산하는 것 등)이 완료되면, 환율을 이용해서 결과 Expression을 단일 통화로 축약할 수 있다.


- 우린 지금 설계상 중요한 결정을 내렸다. 단순히 `...reduce = sum.reduce("USD", bank)`라고 쓸 수도 있었다.
- 왜 Bank가 `reduce()`를 수행 할 책임을 맡아야 하나? 한 가지 답은 "그게 제일 먼저 떠올랐다."는 건데, 이건 별로 유익하지 않다.
- 왜 축약이 수식이 아닌 은행의 책임이어야 한다는 생각이 머리에 떠올랐을까? 현재 내가 설명할 수 있는 것은 다음과 같다.
  - Expression은 우리가 하려고 하는 일의 핵심에 해당한다.
  - 나는 핵심이 되는 객체가 다른 부분에 대해서 될 수 있는 한 모르도록 노력한다.
  - 그렇게 하면 핵심 객체가 가능한 오랫 동안 유연할 수 있다.
  - 게다가 테스트하기에 쉬울 뿐 아니라, 재활용하거나 이해하기에 모두 쉬운 상태로 남아 있을 수 있다.
  - Expression과 관련이 있는 오퍼레이션이 많을 거라고 상상할 수 있다.
  - 만약에 모든 오퍼레이션을 Expression에만 추가한다면 Expression은 무한히 커질 것이다.