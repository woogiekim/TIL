# 초록 막대 패턴

- 깨진 테스트가 있다면 그걸 고쳐야 한다.
- 빨간 막대를 가능한 한 빨릭 고쳐야 하는 조건으로 다룬다면
- 당신은 금세 초록 막대로 옮겨갈 수 있다는 것을 깨달게 될 것이다.

## 가짜로 구현하기(진짜로 만들기 전까지만)

- 실패하는 테스트를 만든 후 첫 버째 구현은 어떻게 하는 게 좋을까?
- 상수를 반환하게 하라.
- 어떤 사람들은 가짜로 구현하기에 꽤나 화를 내기도 한다.
- 왜 들어낼 걸 알면서도 그걸 해야 하나?
- 왜냐하면 뭔가 돌아가는 걸 가진 게 그렇지 않은 것보다 좋기 때문이다.
- 심리학적 - 막대가 초록색일 때, 자신이 어디에 서 있는지 안다. 당신은 확신을 갖고 거기부터 리팩토링해 갈 수 있다.
- 범위(scope) 조절 - 프로그래머들은 모든 종류의 미래 문제를 상상하는 데에 탁월하다. 하나의 구체적인 예에서 시작해서 일반화하게 되면, 쓰잘데기 없는 고민으로 때 이르게 혼동하는 일을 예방할 수 있다. 다음 테스트 케이스를 구현할 때, 이전 테스트의 작동이 보장된다는 것을 알기 때문에 그 다음 테스트 케이스에도 집중할 수 있다.

## 삼각측량

- 추상화 과정을 테스트로 주도할 때 어떻게 최대한 보수적으로 할 수 있겠는가?
- 오로지 예가 두 개 이상일 때에만 추상화를 하라.
- 두 정수의 합을 반환하는 함수를 작성하고 싶다고 가정하자. 다음과 같이 작성한다.
```java
public void testSum() {
    assertEquals(4, plus(3, 1));
}

private int plus(int augend, int addend) {
    return 4;
}
```
- 삼각측량(triangulate)을 사용해서 바른 설계로 간다면 다음과 같이 작성해야 한다.
```java
public void testSum() {
    assertEquals(4, plus(3, 1));
    assertEquals(7, plus(3, 4));
}
```
- 우리가 두 번째 예를 얻었을 때 plus()의 구현을 추상화할 수 있다.
```java
private int plus(int augend, int addend) {
    return augend + addend;
}
```
- 삼각측량이 매력적인 이유는 그 규칙이 매우 명확하기 때문이다.
- 가짜로 구현하기를 위한 규칙들은, 추상을 끌어내기 위한 가짜 구현과 테스트 케이스 사이의 중복에 대한 우리 감각에 의존하는 것으로, 약간 모호해 보이고 달리 해석될 수 있다.
- 삼각측량의 법칙들이 비록 단순해 보이기는 하지만 그것은 무한 루프를 만들어 낸다.
- 두 단언이 있고, plus를 위한 바른 구현을 추상화했다면, 두 단언 중 하나를 삭제할 수 있는데, 그것이 하나와 완전히 중복되기 때문이다.
- 하지만 그렇게 하면 우리는 plus()의 구현을 단순히 상수를 반환하는 것으로 단순화할 수 있는데, 그렇게 되면 다시 단언을 하나 추가해야 한다.
- 어떤 계산을 어떻게 해야 올바르게 추상화할 것인지 정말 감잡기 어려울 때 삼각측량을 사용한다.
- 그 외의 경우, 명백한 구현이나 가짜로 구현하기에 의존한다.

## 명백한 구현

- 단순한 연산들을 어떻게 구현하는가?
- 그냥 구현해 버려라.
- 그냥 명백한 구현을 입력할 것이다. 만약 빨간 막대를 보고 놀란다면 그제서야 좀더 작은 발걸음으로 옮겨갈 것이다.
- 만약 당신이 작성하는 것이 테스트를 통과시킬 수 있는 가장 단순한 변경이 아니라면 어떨까?
- 만약 파트너가 훨씬 단순한 변경을 보여준다면?
- 당신은 실패다!
- 당신 주변의 세상이 무너져 버린다! 당신은 죽어버린다. 완전히 얼어 버린다.
- '제대로 동작하는'을 푸는 동시에 '깨끗한 코드'를 해결하려는 것은 한번에 하기에는 너무 많은 일일 수 있다.
- 그렇게 되면 우선 '제대로 동작 하는'으로 되돌아가 가서 그걸 해결하고,
- 그 후에 '깨끗한 코드'를 느긋하게 해결하도록 하라.
- 명백한 구현을 사용하는 중에 빨간 막대로 얼마나 자주 놀라는지 기록 하도록 하라.
- 명백한 구현을 타이핑해 넣지만 그게 제대로 동작하지 않는 주기에 빠질 것이다.
- 하지만 지금은 뭘 타이핑해야 하는지 제대로 알고 있다는 확신이 든다.
- 그래서 그걸 타이핑한다. 제대로 작동하지 않는다.
- 그럼 이제는 어떻게 해야 한다...
- 이런 것은 하나 차이의 오류(off-by-one error)와 양수/음수 에러에서 특히 많이 일어난다.

## 하나에서 여럿으로

- 객체 컬렉션(collection)을 다루는 연산은 어떻게 구현하나?
- 일단은 컬렉션 없이 구현하고 그 다음에 컬렉션을 사용하게 한다.