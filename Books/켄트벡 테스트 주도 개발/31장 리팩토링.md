# 리팩토링

- TDD에서는 리팩토링을 특이한 방법으로 사용한다.
- 일반적으로 리팩토링은 어떤 상황에서도 프로그램의 읨론을 변경해서는 안 된다.
- 하지만 TDD에서 우리가 신경 쓰는 부분은 현재 이미 통과한 테스트들뿐이다.
- 예를 들어 TDD에서는 상수를 변수로 바꾸고 양심에 꺼리낌 없이 이를 리팩토링이라고 한다.
- 왜냐하면 이 행위가 통과하는 테스트의 집합에 아무 변화도 주지 않기 떄문이다.
- 의미론이 유지되는 상황이란 사실 태스트 케이스 하나일 수도 있다.
- 그럴 떄 이전에 통과한 다른 테스트 케이스들은 실패하게 될 것이다.
- 하지만 우린 아직 나머지 테스트를 만들지 않았기 때문에 이 테스트들에 대해서는 걱정할 필요가 없다.
- 이 '관측상의 동치성'이 성립되려면 충분한 테스트를 가지고 있어야 한다.
- 여기에서 충분한 테스트란, 현재 가지고 있는 테스트들에 기반한 리팩토링이 추측 가능한 모든 테스트에 기반한 리팩토링과 동일한 것으로 여겨질 수 있는 상태를 말한다.
- "문제가 있다는 건 알지만 테스트는 모두 통과하니까 일단 CVS에 체크인 해야지."하고 말할 수는 없다.
- 만약 그런 생각이 든다면 테스트를 더 만들어야 한다.

## 차이점 일치시키기

- 비슷해 보이는 두 코드 조각을 하빛려면 어떻게 해야 할까?
- 두 코드가 단계적으로 닮아가게끔 수정한다.
- 이 둘이 완전히 동일해지면 둘을 합친다.
- 우리가 작은 단계와 명확한 피드백을 이용해서 피해가고자 하는 일이 바로, 불확실한 믿음에 의지하여 단계를 크게 건더뛰는 리팩토링이다.